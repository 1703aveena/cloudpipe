---
cloudpipe:
  build: .
  links:
  - mongo
  - authstore
  environment:
    PIPE_ADMINNAME: admin
    PIPE_ADMINKEY: 12345
    PIPE_LOGLEVEL: debug
    PIPE_LOGCOLORS: true
    PIPE_CACERT: /certificates/ca.pem
    PIPE_CERT: /certificates/cloudpipe-cert.pem
    PIPE_KEY: /certificates/cloudpipe-key.pem
    PIPE_AUTHSERVICE: https://authstore:8000/v1
  ports:
  - "8000:8000"
  volumes:
  - "/var/run/docker.sock:/var/run/docker.sock"
  - "certificates:/certificates"
authstore:
  image: cloudpipe/auth-store
  links:
  - mongo
  environment:
    AUTH_LOGLEVEL: debug
    AUTH_LOGCOLORS: true
    AUTH_CACERT: /certificates/ca.pem
    AUTH_CERT: /certificates/auth-store-cert.pem
    AUTH_KEY: /certificates/auth-store-key.pem
  ports:
  - "8001:8000"
  volumes:
  - "certificates:/certificates"
mongo:
  image: mongo:2.8
dummyuserimage:
  image: cloudpipe/runner-py2
  command: "echo 'User image loaded'"
